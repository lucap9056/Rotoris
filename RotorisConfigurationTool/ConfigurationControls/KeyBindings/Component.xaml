<UserControl x:Class="RotorisConfigurationTool.ConfigurationControls.KeyBindings.Component"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:c="clr-namespace:RotorisConfigurationTool.ConfigurationControls"
             xmlns:local="clr-namespace:RotorisConfigurationTool.ConfigurationControls.KeyBindings"
             xmlns:i18n="clr-namespace:RotorisConfigurationTool.Properties.ConfigurationControls.KeyBindings"
             mc:Ignorable="d" 
             d:DataContext="{d:DesignInstance c:MainContext}"
             >
    <UserControl.Resources>
        <local:KeyBindingsStateConverter x:Key="KeyBindingsStateConverter" />
        <local:HotkeyTextConverter x:Key="HotkeyTextConverter" />
        <local:TrunoffKeyboardCapture x:Key="TrunoffKeyboardCapture" />
        <local:EditingKeyBorderBrushConverter x:Key="EditingKeyBorderBrushConverter" />
    </UserControl.Resources>
    <Grid Margin="15" Width="250"
          d:DataContext="{d:DesignInstance local:KeyBindingsState}"
        >
        <Grid.DataContext>
            <MultiBinding Converter="{StaticResource KeyBindingsStateConverter}">
                <Binding RelativeSource="{RelativeSource AncestorType={x:Type UserControl}}" Path="DataContext" />
                <Binding RelativeSource="{RelativeSource AncestorType={x:Type UserControl}}" Path="IsTabSelected" />
            </MultiBinding>
        </Grid.DataContext>

        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="10"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <Grid.Tag>
            <MultiBinding Converter="{StaticResource TrunoffKeyboardCapture}">
                <Binding RelativeSource="{RelativeSource AncestorType={x:Type Window}}" Path="IsActive" />
                <Binding RelativeSource="{RelativeSource Mode=Self}" Path="DataContext"/>
            </MultiBinding>
        </Grid.Tag>

        <Button 
            Grid.Column="0" Grid.ColumnSpan="2"
            Grid.Row="0" Grid.RowSpan="5"
            Margin="-20"
            Width="Auto" Height="Auto" Opacity="0"
            HorizontalAlignment="Stretch" VerticalAlignment="Stretch"
            >
            <Button.InputBindings>
                <MouseBinding MouseAction="LeftClick" Command="{Binding DisableKeyboardCaptureCommand}" />
            </Button.InputBindings>
        </Button>

        <TextBlock Text="▶ ：" 
                   IsHitTestVisible="False"
                   Grid.Row="0" Grid.Column="0" 
                   VerticalAlignment="Center"/>
        <TextBox 
            Grid.Row="0" Grid.Column="1" 
            Margin="0,0,0,5" 
            Padding="2"
            IsReadOnly="True"
            Focusable="False"
            Height="24"
            TextAlignment="Center"
            ContextMenu="{x:Null}"
            InputMethod.PreferredImeState="On"
            InputMethod.PreferredImeConversionMode="Alphanumeric"
            InputMethod.IsInputMethodEnabled="False"
            Text="{Binding PrimaryKey, Converter={StaticResource HotkeyTextConverter}}"
            Tag="{x:Static local:TriggerKeys.PrimaryKey}"
            >
            <TextBox.BorderBrush>
                <MultiBinding Converter="{StaticResource EditingKeyBorderBrushConverter}">
                    <Binding RelativeSource="{RelativeSource Mode=Self}" />
                    <Binding Path="EditingKey"/>
                </MultiBinding>
            </TextBox.BorderBrush>
            <TextBox.InputBindings>
                <MouseBinding 
                    MouseAction="LeftClick" 
                    Command="{Binding EnableKeyboardCaptureCommand}" 
                    CommandParameter="{Binding RelativeSource={RelativeSource AncestorType={x:Type TextBox}}}" 
                    />
            </TextBox.InputBindings>
        </TextBox>

        <TextBlock Text="↻ ：" 
                   IsHitTestVisible="False"
                   Grid.Row="1" Grid.Column="0" 
                   VerticalAlignment="Center"/>
        <TextBox 
            Grid.Row="1" Grid.Column="1" 
            Margin="0,5,0,5" 
            Padding="2"
            IsReadOnly="True"
            Focusable="False"
            Height="24"
            TextAlignment="Center"
            ContextMenu="{x:Null}"
            InputMethod.PreferredImeState="On"
            InputMethod.PreferredImeConversionMode="Alphanumeric"
            InputMethod.IsInputMethodEnabled="False"
            Text="{Binding ClockwiseKey, Converter={StaticResource HotkeyTextConverter}}"
            Tag="{x:Static local:TriggerKeys.ClockwiseKey}"
            >
            <TextBox.BorderBrush>
                <MultiBinding Converter="{StaticResource EditingKeyBorderBrushConverter}">
                    <Binding RelativeSource="{RelativeSource Mode=Self}" />
                    <Binding Path="EditingKey"/>
                </MultiBinding>
            </TextBox.BorderBrush>
            <TextBox.InputBindings>
                <MouseBinding 
                    MouseAction="LeftClick" 
                    Command="{Binding EnableKeyboardCaptureCommand}" 
                    CommandParameter="{Binding RelativeSource={RelativeSource AncestorType={x:Type TextBox}}}" 
                    />
            </TextBox.InputBindings>
        </TextBox>

        <TextBlock Text="↺ ：" 
                   IsHitTestVisible="False"
                   Grid.Row="2" Grid.Column="0" 
                   VerticalAlignment="Center"/>
        <TextBox 
            Grid.Row="2" Grid.Column="1" 
            Margin="0,5,0,0" 
            Padding="2"
            IsReadOnly="True"
            Focusable="False"
            Height="24"
            TextAlignment="Center"
            ContextMenu="{x:Null}"
            InputMethod.PreferredImeState="On"
            InputMethod.PreferredImeConversionMode="Alphanumeric"
            InputMethod.IsInputMethodEnabled="False"
            Text="{Binding CounterclockwiseKey, Converter={StaticResource HotkeyTextConverter}}"
            Tag="{x:Static local:TriggerKeys.CounterclockwiseKey}"
            >
            <TextBox.BorderBrush>
                <MultiBinding Converter="{StaticResource EditingKeyBorderBrushConverter}">
                    <Binding RelativeSource="{RelativeSource Mode=Self}" />
                    <Binding Path="EditingKey"/>
                </MultiBinding>
            </TextBox.BorderBrush>
            <TextBox.InputBindings>
                <MouseBinding 
                    MouseAction="LeftClick" 
                    Command="{Binding EnableKeyboardCaptureCommand}" 
                    CommandParameter="{Binding RelativeSource={RelativeSource AncestorType={x:Type TextBox}}}" 
                    />
            </TextBox.InputBindings>
        </TextBox>

        <Button 
            Content="{x:Static i18n:I18n.Default}"
            Grid.Row="4" Grid.Column="1"
            HorizontalAlignment="Left"
            >
            <Button.InputBindings>
                <MouseBinding MouseAction="LeftClick" Command="{Binding SetDefaultCommand}" />
            </Button.InputBindings>
        </Button>

        <Button 
            Content="{x:Static i18n:I18n.Save}"
            Grid.Row="4" Grid.Column="1"
            HorizontalAlignment="Right"
            >
            <Button.InputBindings>
                <MouseBinding MouseAction="LeftClick" Command="{Binding SaveCommand}" />
            </Button.InputBindings>
        </Button>
    </Grid>
</UserControl>
